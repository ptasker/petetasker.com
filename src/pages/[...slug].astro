---
import ProgrammerLayout from '../layouts/ProgrammerLayout.astro';

export async function getStaticPaths() {
  const postModules = import.meta.glob('../../content/blog/**/*.md', { eager: true });

  return Object.entries(postModules).map(([path, module]: [string, any]) => {
      const post = { ...module, file: path };
      const slug = post.frontmatter.permalink
        ? post.frontmatter.permalink.replace(/^\//, '') // Remove leading slash for Astro dynamic route
        : path.split('/').pop()?.split('.').shift();

      return {
        params: { slug },
        props: { post },
      };
  });
}

const { post } = Astro.props;
const { Content } = post;
---

<ProgrammerLayout title={post.frontmatter.title} description={post.frontmatter.description}>
  <article class="max-w-4xl mx-auto">
    <header class="mb-8 pb-8 border-b border-slate-200 dark:border-slate-700">
      <div class="text-sm font-mono text-green-600 dark:text-green-400 mb-2">
         {new Date(post.frontmatter.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
      </div>
      <h1 class="text-3xl md:text-5xl font-bold text-slate-900 dark:text-slate-100 mb-4">
        {post.frontmatter.title}
      </h1>
      {post.frontmatter.description && (
        <p class="text-xl text-slate-600 dark:text-slate-400 font-light">
          {post.frontmatter.description}
        </p>
      )}
    </header>

    <div class="prose prose-lg prose-slate dark:prose-invert max-w-none
                prose-headings:font-bold prose-headings:tracking-tight
                prose-code:text-green-600 dark:prose-code:text-green-400 prose-code:bg-slate-100 dark:prose-code:bg-slate-800 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:before:content-none prose-code:after:content-none
                prose-pre:bg-slate-900 prose-pre:border prose-pre:border-slate-700
                ">
      <Content />
    </div>
  </article>
</ProgrammerLayout>
